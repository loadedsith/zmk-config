on: [push, pull_request, workflow_dispatch]

jobs:
  # Keep your standard ZMK build via the reusable workflow
  zmk:
    uses: zmkfirmware/zmk/.github/workflows/build-user-config.yml@main
    with:
      build_matrix_path: build.yaml

  dts_right:
    name: Dump DTS (right half)
    runs-on: ubuntu-latest
    container:
      image: zmkfirmware/zmk-build-arm:stable
    permissions:
      contents: read
      packages: read
      actions: write

    steps:
      - uses: actions/checkout@v4

      - name: Build right (produce zephyr.dts)
        run: ./build_dts.sh waterfowl_right nice_oled config/waterfowl_right.overlay nice_nano_v2

      - name: List artifacts (sanity)
        run: ls -la build/zephyr || true

      - name: Upload DTS
        uses: actions/upload-artifact@v4
        with:
          name: dts-waterfowl-right
          if-no-files-found: error
          path: |
            build/zephyr/zephyr.dts
            build/zephyr/zephyr.dtsi
